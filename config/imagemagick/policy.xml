<policymap>
  <!-- WARNING: This file is specifically meant for the
    ImageMagick version shipped with Ubuntu 18.04 and may not
    be as secure with other versions.

    If possible, update to ImageMagick 6.9.7-7 or newer and use
    the file shipped with Mastodon.
  -->

  <!-- Set some basic system resource limits -->
  <policy domain="resource" name="time" value="60" />

  <policy domain="module" rights="none" pattern="URL" />

  <policy domain="filter" rights="none" pattern="*" />

  <!--
    Ideally, we would restrict ImageMagick to only accessing its own
    disk-backed pixel cache as well as Mastodon-created Tempfiles.

    However, those paths depend on the operating system and environment
    variables, so they can only be known at runtime.

    Furthermore, those paths are not necessarily shared across Mastodon
    processes, so even creating a policy.xml at runtime is impractical.

    For the time being, only disable indirect reads.
  -->
  <policy domain="path" rights="none" pattern="@*" />

  <!-- Disallow any coder by default, and only enable ones required by Mastodon -->
  <policy domain="coder" rights="none" pattern="{BGR,BMP,BRAILLE,CALS,CMYK,DDS,DNG,DOT,EPT,FAX,FITS,GRADIENT,HTML,ICON,INLINE,JBIG,JP2,MAGICK,META,MPEG,MPR,PCD,PCX,PDF,PICT,PLASMA,PNM,PS,PS2,PS3,PSD,RAW,SIXEL,SUN,SVG,TGA,TIFF,TTF,TXT,URL,UYVY,VIFF,WMF,XC,XPM,XTRN,YCbCr,EPHEMERAL,HTTPS,MVG,MSL,TEXT,SHOW,WIN,PLT}" />
</policymap>